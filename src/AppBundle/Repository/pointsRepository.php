<?php

namespace AppBundle\Repository;

use Doctrine\ORM\EntityRepository;

/**
 * pointsRepository
 *
 * This class was generated by the PhpStorm "Php Annotations" Plugin. Add your own custom
 * repository methods below.
 */
class pointsRepository extends EntityRepository
{
    public function findSumPoints($player)
    {
        return $this->createQueryBuilder('point')
            ->select('SUM(point.points) as sumPoints, games.name, games.id', 'games.description')
            ->leftJoin('point.games', 'games')
            ->andWhere('point.players = :player')
            ->setParameter(':player', $player)
            ->addGroupBy('games.id', 'point.games')
            ->getQuery()
            ->getResult();
    }

    public function sumPointsPerGame()
    {
        return $this->createQueryBuilder('points')
            ->select('max(points.points) as punts, games.name as gameName, players.name')
            ->leftJoin('points.games', 'games')
            ->leftJoin('points.players','players')
            ->addGroupBy('games.id', 'players')
            ->getQuery()
            ->getArrayResult();
    }
}

